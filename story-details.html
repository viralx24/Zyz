<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e94560">
    
    <!-- Comprehensive PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ViralXHub Story">
    
    <!-- Comprehensive PWA Icons for All Devices -->
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="57x57" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="60x60" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="72x72" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="76x76" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="114x114" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="120x120" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="144x144" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="152x152" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    
    <!-- Android & Windows Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="icon" type="image/png" sizes="16x16" href="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#e94560">
    <meta name="msapplication-TileImage" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    
    <!-- SEO Meta Tags -->
    <title id="story-title">Bangla Sex Story - বাংলা সেক্স গল্প | ViralXHub</title>
    <meta id="story-description" name="description" content="বাংলা সেক্স গল্প পড়ুন ViralXHub এ - রোমান্টিক, কলেজ, ফ্যামিলি, ফ্যান্টাসি এবং বিভিন্ন ধরনের প্রাপ্তবয়স্ক গল্পের সংগ্রহ">
    <meta name="keywords" content="bangla sex story, bengali sex story, bangla adult story, বাংলা সেক্স গল্প, প্রাপ্তবয়স্ক গল্প">
    <meta name="robots" content="index, follow">
    <meta name="author" content="ViralXHub">
    
    <!-- Comprehensive Open Graph Meta Tags for Social Media Sharing -->
    <meta property="og:title" id="og-title" content="Bangla Sex Story - বাংলা সেক্স গল্প | ViralXHub">
    <meta property="og:description" id="og-description" content="বাংলা সেক্স গল্প পড়ুন ViralXHub এ - রোমান্টিক, কলেজ, ফ্যামিলি, ফ্যান্টাসি এবং বিভিন্ন ধরনের প্রাপ্তবয়স্ক গল্পের সংগ্রহ">
    <meta property="og:type" content="article">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:image" id="og-image" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:alt" content="ViralXHub - Bangla Sex Stories">
    <meta property="og:site_name" content="ViralXHub">
    <meta property="og:locale" content="bn_BD">
    
    <!-- Additional OG Images for Different Platforms -->
    <meta property="og:image:url" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <meta property="og:image:secure_url" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bangla Sex Story - বাংলা সেক্স গল্প | ViralXHub">
    <meta name="twitter:description" content="বাংলা সেক্স গল্প পড়ুন ViralXHub এ - রোমান্টিক, কলেজ, ফ্যামিলি, ফ্যান্টাসি এবং বিভিন্ন ধরনের প্রাপ্তবয়স্ক গল্পের সংগ্রহ">
    <meta name="twitter:image" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <meta name="twitter:image:alt" content="ViralXHub - Bangla Sex Stories">
    <meta name="twitter:site" content="@ViralXHub">
    
    <!-- WhatsApp Specific Meta Tags -->
    <meta property="og:image" content="https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg">
    <meta property="og:image:type" content="image/jpeg">
    
    <!-- Canonical URL -->
    <link rel="canonical" id="canonical-url" href="">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "Bangla Sex Story - বাংলা সেক্স গল্প",
        "description": "বাংলা সেক্স গল্প পড়ুন ViralXHub এ",
        "author": {
            "@type": "Organization",
            "name": "ViralXHub"
        },
        "publisher": {
            "@type": "Organization",
            "name": "ViralXHub",
            "logo": {
                "@type": "ImageObject",
                "url": "https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg"
            }
        },
        "datePublished": "",
        "genre": "Bangla Sex Stories",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": ""
        }
    }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            line-height: 1.6;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        body.menu-open {
            overflow: hidden;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #16213e;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e94560;
            text-decoration: none;
        }

        /* Menu Button Section */
        .menu-button-section {
            text-align: center;
            padding: 1rem;
            background-color: #111;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .menu-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: white;
            text-decoration: none;
            font-weight: bold;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .menu-btn:hover {
            background: #e94560;
            transform: translateY(-2px);
        }

        .menu-btn i {
            margin-right: 0.5rem;
        }

        /* TikTok Icon Style */
        .tiktok-icon {
            color: #ff0050;
            text-shadow: 0 0 8px rgba(255, 0, 80, 0.5);
        }

        /* Sidebar Menu */
        .sidebar-menu {
            position: fixed;
            top: 0;
            left: -320px;
            width: 320px;
            height: 100vh;
            background: linear-gradient(to bottom, #16213e, #0f3460);
            z-index: 2000;
            transition: left 0.3s ease;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
        }

        .sidebar-menu.open {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1999;
            display: none;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-title {
            font-size: 1.5rem;
            color: #e94560;
            font-weight: bold;
        }

        .close-menu {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-menu:hover {
            color: #e94560;
            transform: scale(1.2);
        }

        .sidebar-nav {
            margin-bottom: 30px;
        }

        .sidebar-nav-item {
            display: block;
            padding: 12px 15px;
            margin-bottom: 10px;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar-nav-item:hover, .sidebar-nav-item.active {
            background: #e94560;
            transform: translateX(5px);
        }

        .sidebar-nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Story Detail Section */
        .story-detail-section {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        .story-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e94560;
        }

        .story-title {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .story-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .story-category {
            background: #0f3460;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: #fff;
            font-weight: bold;
        }

        .story-date {
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .story-content {
            background: #16213e;
            padding: 2rem;
            border-radius: 12px;
            line-height: 1.8;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .story-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .story-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-top: 1px solid #0f3460;
            border-bottom: 1px solid #0f3460;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1.2rem;
            background: #0f3460;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .action-btn:hover {
            background: #e94560;
            transform: translateY(-2px);
        }

        .like-btn.liked {
            background: #e94560;
            color: white;
        }

        /* Related Stories */
        .related-stories {
            margin-top: 3rem;
        }

        .section-heading {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #fff;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e94560;
            display: inline-block;
        }

        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .story-card {
            background: linear-gradient(145deg, #16213e, #1a1a2e);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #0f3460;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .story-card:hover {
            transform: translateY(-5px);
        }

        .story-card-title {
            color: #e94560;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            line-height: 1.4;
        }

        .story-card-summary {
            color: #b8b8b8;
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .read-more-btn {
            display: inline-block;
            background: #e94560;
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            transition: background 0.3s ease;
            font-weight: 600;
            text-align: center;
            width: 100%;
            border: none;
            cursor: pointer;
        }

        .read-more-btn:hover {
            background: #ff6b8b;
        }

        /* Banner Ad Styles */
        .banner-ad {
            width: 100%;
            padding: 1rem;
            background-color: #0f3460;
            margin: 1.5rem 0;
            text-align: center;
            border-radius: 8px;
            border: 1px solid #e94560;
        }

        .banner-ad img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .ad-label {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Footer */
        footer {
            background-color: #16213e;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .footer-links a {
            color: #fff;
            text-decoration: none;
            margin: 0 1rem;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .footer-links a:hover {
            background-color: #e94560;
        }

        .social-icons {
            margin-bottom: 1.5rem;
        }

        .social-icons a {
            color: #fff;
            font-size: 1.5rem;
            margin: 0 0.8rem;
            transition: color 0.3s ease;
        }

        .social-icons a:hover {
            color: #e94560;
        }

        .footer-info {
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
            color: #aaa;
            line-height: 1.8;
        }

        .copyright {
            margin-top: 1.5rem;
            color: #777;
            font-size: 0.8rem;
        }

        /* Loading Spinner */
        .loader {
            display: none;
            border: 5px solid #333;
            border-top: 5px solid #e94560;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            text-align: center;
            padding: 3rem;
            background: #16213e;
            border-radius: 12px;
            margin: 2rem 0;
        }

        .error-message i {
            font-size: 4rem;
            color: #e94560;
            margin-bottom: 1rem;
        }

        .error-message h2 {
            color: #e94560;
            margin-bottom: 1rem;
        }

        .error-message p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #ccc;
            margin-bottom: 1.5rem;
        }

        /* Breadcrumb */
        .breadcrumb {
            padding: 1rem 2rem;
            background: #0f3460;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: #e94560;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .story-detail-section {
                padding: 1rem;
            }
            
            .story-title {
                font-size: 1.5rem;
            }
            
            .story-meta {
                flex-direction: column;
                gap: 1rem;
            }
            
            .story-content {
                padding: 1.5rem;
                font-size: 1rem;
            }
            
            .story-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .action-btn {
                justify-content: center;
            }
            
            .stories-grid {
                grid-template-columns: 1fr;
            }

            .menu-button-section {
                flex-direction: row;
                gap: 0.5rem;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 1rem 0.5rem;
            }
            
            .menu-btn {
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
                flex-shrink: 0;
            }

            .sidebar-menu {
                width: 280px;
                left: -280px;
            }
        }

        @media (max-width: 480px) {
            .story-title {
                font-size: 1.3rem;
            }
            
            .story-content {
                padding: 1rem;
            }
            
            .menu-button-section {
                gap: 0.3rem;
            }
            
            .menu-btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }

            .sidebar-menu {
                width: 250px;
                left: -250px;
            }
        }
    </style>
</head>
<body itemscope itemtype="https://schema.org/WebPage">
    <!-- Header -->
    <header>
        <a href="index.html" class="logo">ViralXHub</a>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="index.html">Home</a> &gt; 
        <a href="stories.html">Stories</a> &gt; 
        <span id="breadcrumb-title">Story Details</span>
    </div>

    <!-- Menu Button Section -->
    <div class="menu-button-section">
        <button class="menu-btn" id="menu-btn">
            <i class="fas fa-bars"></i> Menu
        </button>
        <a href="sex-video.html" class="menu-btn">
            <i class="fas fa-video"></i> Sex Video
        </a>
        <a href="stories.html" class="menu-btn">
            <i class="fas fa-book"></i> Sex Story
        </a>
        <a href="sex-tiktok.html" class="menu-btn">
            <i class="fab fa-tiktok tiktok-icon"></i> Sex TikTok
        </a>
        <button class="menu-btn" id="upload-story-btn-top">
            <i class="fas fa-upload"></i> Upload Story
        </button>
    </div>

    <!-- Sidebar Menu -->
    <div class="sidebar-menu" id="sidebar-menu">
        <div class="sidebar-header">
            <div class="sidebar-title">ViralXHub Menu</div>
            <button class="close-menu" id="close-menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="index.html" class="sidebar-nav-item">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="stories.html" class="sidebar-nav-item">
                <i class="fas fa-book"></i> Story Collection
            </a>
            <a href="sex-video.html" class="sidebar-nav-item">
                <i class="fas fa-video"></i> Sex Video
            </a>
            <a href="sex-tiktok.html" class="sidebar-nav-item">
                <i class="fab fa-tiktok tiktok-icon"></i> Sex TikTok
            </a>
            <a href="about.html" class="sidebar-nav-item">
                <i class="fas fa-info-circle"></i> About Us
            </a>
            <a href="contact.html" class="sidebar-nav-item">
                <i class="fas fa-envelope"></i> Contact
            </a>
            <a href="privacy-policy.html" class="sidebar-nav-item">
                <i class="fas fa-shield-alt"></i> Privacy Policy
            </a>
        </nav>
        
        <div class="sidebar-about">
            <h3>About ViralXHub</h3>
            <p>ViralXHub is a collection of Bengali adult stories and sex stories. Here you will find romantic, college, family, fantasy and various types of adult stories. Our goal is to provide quality and engaging content for our readers.</p>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Story Detail Section -->
    <div class="story-detail-section">
        <div class="story-header">
            <h1 class="story-title" id="story-title-display">Loading Story...</h1>
            <div class="story-meta">
                <span class="story-category" id="story-category-display">Category</span>
                <span class="story-date" id="story-date-display">
                    <i class="far fa-calendar"></i> Loading...
                </span>
            </div>
        </div>

        <!-- Banner Ad -->
        <div class="banner-ad">
            <div class="ad-label">Advertisement</div>
            <img src="https://via.placeholder.com/728x90/0f3460/e94560?text=ViralXHub+Premium+Stories" alt="ViralXHub Premium Stories Advertisement" title="ViralXHub Premium Stories">
        </div>

        <div class="story-content" id="story-content-display">
            <div class="loader" id="loader"></div>
        </div>

        <!-- Story Actions -->
        <div class="story-actions">
            <button class="action-btn like-btn" id="like-btn">
                <i class="far fa-heart"></i> Like
            </button>
            <a href="stories.html" class="action-btn">
                <i class="fas fa-arrow-left"></i> Back to Stories
            </a>
            <button class="action-btn" id="share-btn">
                <i class="fas fa-share"></i> Share
            </button>
        </div>

        <!-- Related Stories -->
        <div class="related-stories">
            <h2 class="section-heading">Related Stories</h2>
            <div class="stories-grid" id="related-stories-grid">
                <!-- Related stories will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Final Ad Banner -->
    <div class="banner-ad">
        <div class="ad-label">Advertisement</div>
        <img src="https://via.placeholder.com/728x90/0f3460/e94560?text=ViralXHub+Premium+Stories" alt="ViralXHub Premium Stories Advertisement" title="ViralXHub Premium Stories">
    </div>

    <!-- Footer -->
    <footer itemprop="footer">
        <div class="social-icons">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
            <a href="#" aria-label="Telegram"><i class="fab fa-telegram"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" aria-label="TikTok"><i class="fab fa-tiktok tiktok-icon"></i></a>
        </div>
        <div class="footer-links">
            <a href="index.html">Home</a>
            <a href="stories.html">Story Collection</a>
            <a href="sex-video.html">Sex Video</a>
            <a href="sex-tiktok.html">Sex TikTok</a>
            <a href="about.html">About Us</a>
            <a href="contact.html">Contact</a>
            <a href="privacy-policy.html">Privacy Policy</a>
        </div>
        <div class="footer-info">
            <p>© 2024 ViralX Hub. All rights reserved. Disclaimer: The stories displayed on this website are collected from various open sources. ViralX Hub does not claim ownership of the content displayed. If any material infringes copyright, please contact us at viralxhub.temp@gmail.com</p>
        </div>
        <div class="copyright">
            <p>ViralXHub - Your destination for Bengali adult stories and sex stories</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Supabase initialization
            const supabaseUrl = 'https://lvmionmnzjnzgtygjjmq.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2bWlvbm1uempuemd0eWdqam1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NzAxOTgsImV4cCI6MjA3NzM0NjE5OH0.JPPz4H5gmeLukD2YKHo-QxvqZ73G7w170D4uhncdy10';

            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

            // DOM Elements
            const storyTitleDisplay = document.getElementById('story-title-display');
            const storyCategoryDisplay = document.getElementById('story-category-display');
            const storyDateDisplay = document.getElementById('story-date-display');
            const storyContentDisplay = document.getElementById('story-content-display');
            const relatedStoriesGrid = document.getElementById('related-stories-grid');
            const breadcrumbTitle = document.getElementById('breadcrumb-title');
            const loader = document.getElementById('loader');
            const likeBtn = document.getElementById('like-btn');
            const shareBtn = document.getElementById('share-btn');
            
            // Menu Elements
            const menuBtn = document.getElementById('menu-btn');
            const uploadStoryBtnTop = document.getElementById('upload-story-btn-top');
            const sidebarMenu = document.getElementById('sidebar-menu');
            const closeMenu = document.getElementById('close-menu');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            
            // Variables
            let currentStoryId = null;
            let currentStory = null;

            // Get story ID from URL parameters
            function getStoryIdFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('id');
            }

            // HTML Sanitization Function
            function sanitizeHTML(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }

            // Format date for display
            function formatDate(dateString) {
                try {
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(dateString).toLocaleDateString('en-US', options);
                } catch (error) {
                    return 'Unknown date';
                }
            }

            // Menu functionality
            function openMenu() {
                sidebarMenu.classList.add('open');
                sidebarOverlay.classList.add('active');
                document.body.classList.add('menu-open');
            }

            function closeMenuFunc() {
                sidebarMenu.classList.remove('open');
                sidebarOverlay.classList.remove('active');
                document.body.classList.remove('menu-open');
            }

            menuBtn.addEventListener('click', openMenu);
            closeMenu.addEventListener('click', closeMenuFunc);
            sidebarOverlay.addEventListener('click', closeMenuFunc);

            // Upload story button functionality
            uploadStoryBtnTop.addEventListener('click', () => {
                closeMenuFunc();
                window.location.href = 'index.html#visitor-story-modal';
            });

            // Load story from Supabase
            async function loadStory(storyId) {
                try {
                    loader.style.display = 'block';
                    storyContentDisplay.innerHTML = '<div class="loader"></div>';
                    
                    // Fetch story from Supabase
                    const { data, error } = await supabase
                        .from('stories')
                        .select('*')
                        .eq('id', storyId)
                        .eq('status', 'published')
                        .single();
                    
                    if (error) {
                        throw error;
                    }
                    
                    if (!data) {
                        throw new Error('Story not found');
                    }
                    
                    currentStory = data;
                    displayStory(data);
                    await loadRelatedStories(data.category, storyId);
                    updateMetaTags(data);
                    
                } catch (error) {
                    console.error('Error loading story:', error);
                    showError('Story not found or unavailable.');
                } finally {
                    loader.style.display = 'none';
                }
            }

            // Display story content
            function displayStory(story) {
                // Sanitize content to prevent XSS
                const safeTitle = sanitizeHTML(story.title);
                const safeContent = sanitizeHTML(story.content);
                const safeCategory = sanitizeHTML(story.category);
                
                // Update display elements
                storyTitleDisplay.textContent = safeTitle;
                storyCategoryDisplay.textContent = safeCategory;
                storyDateDisplay.innerHTML = `<i class="far fa-calendar"></i> ${formatDate(story.created_at)}`;
                breadcrumbTitle.textContent = safeTitle;
                
                // Format content with paragraphs
                const formattedContent = safeContent
                    .split('\n')
                    .filter(para => para.trim())
                    .map(para => `<p>${para}</p>`)
                    .join('');
                
                storyContentDisplay.innerHTML = formattedContent;
            }

            // Load related stories
            async function loadRelatedStories(category, excludeId) {
                try {
                    const { data, error } = await supabase
                        .from('stories')
                        .select('*')
                        .eq('category', category)
                        .eq('status', 'published')
                        .neq('id', excludeId)
                        .order('created_at', { ascending: false })
                        .limit(3);
                    
                    if (error) {
                        throw error;
                    }
                    
                    displayRelatedStories(data || []);
                    
                } catch (error) {
                    console.error('Error loading related stories:', error);
                    relatedStoriesGrid.innerHTML = '<p style="color: #aaa; text-align: center;">Unable to load related stories</p>';
                }
            }

            // Display related stories
            function displayRelatedStories(stories) {
                if (stories.length === 0) {
                    relatedStoriesGrid.innerHTML = '<p style="color: #aaa; text-align: center; grid-column: 1 / -1;">No related stories found</p>';
                    return;
                }
                
                let html = '';
                
                stories.forEach(story => {
                    // Sanitize story content
                    const safeTitle = sanitizeHTML(story.title);
                    const safeSummary = sanitizeHTML(story.summary);
                    const safeCategory = sanitizeHTML(story.category);
                    
                    html += `
                        <div class="story-card">
                            <h3 class="story-card-title">${safeTitle}</h3>
                            <p class="story-card-summary">${safeSummary}</p>
                            <div class="story-meta">
                                <span class="story-category">${safeCategory}</span>
                                <span class="story-date">${formatDate(story.created_at)}</span>
                            </div>
                            <button class="read-more-btn" onclick="openStoryPage(${story.id})">Read Full Story</button>
                        </div>
                    `;
                });
                
                relatedStoriesGrid.innerHTML = html;
            }

            // Update meta tags for SEO and Social Sharing
            function updateMetaTags(story) {
                const currentUrl = window.location.href;
                
                // Update page title
                document.title = `${story.title} | ViralXHub`;
                
                // Update meta description
                const metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', story.summary || 'বাংলা সেক্স গল্প পড়ুন ViralXHub এ');
                }
                
                // Update OG tags
                const ogTitle = document.querySelector('meta[property="og:title"]');
                const ogDescription = document.querySelector('meta[property="og:description"]');
                const ogUrl = document.querySelector('meta[property="og:url"]');
                const ogImage = document.querySelector('meta[property="og:image"]');
                
                if (ogTitle) ogTitle.setAttribute('content', story.title);
                if (ogDescription) ogDescription.setAttribute('content', story.summary || 'বাংলা সেক্স গল্প পড়ুন ViralXHub এ');
                if (ogUrl) ogUrl.setAttribute('content', currentUrl);
                if (ogImage) ogImage.setAttribute('content', 'https://i.postimg.cc/9FxtZTfr/file-000000000d2061f58105470ed8bd52a3.jpg');
                
                // Update Twitter tags
                const twitterTitle = document.querySelector('meta[name="twitter:title"]');
                const twitterDescription = document.querySelector('meta[name="twitter:description"]');
                
                if (twitterTitle) twitterTitle.setAttribute('content', story.title);
                if (twitterDescription) twitterDescription.setAttribute('content', story.summary || 'বাংলা সেক্স গল্প পড়ুন ViralXHub এ');
                
                // Update canonical URL
                const canonicalUrl = document.querySelector('link[rel="canonical"]');
                if (canonicalUrl) {
                    canonicalUrl.setAttribute('href', currentUrl);
                }
                
                // Update structured data
                const structuredData = document.querySelector('script[type="application/ld+json"]');
                if (structuredData) {
                    const data = JSON.parse(structuredData.textContent);
                    data.headline = story.title;
                    data.description = story.summary || 'বাংলা সেক্স গল্প পড়ুন ViralXHub এ';
                    data.datePublished = story.created_at;
                    data.genre = story.category;
                    data.mainEntityOfPage = {
                        "@type": "WebPage",
                        "@id": currentUrl
                    };
                    structuredData.textContent = JSON.stringify(data);
                }
            }

            // Show error message
            function showError(message) {
                storyContentDisplay.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h2>Story Not Found</h2>
                        <p>${message}</p>
                        <a href="stories.html" class="action-btn">
                            <i class="fas fa-arrow-left"></i> Back to Stories
                        </a>
                    </div>
                `;
            }

            // Like functionality
            likeBtn.addEventListener('click', function() {
                this.classList.toggle('liked');
                const icon = this.querySelector('i');
                if (this.classList.contains('liked')) {
                    icon.className = 'fas fa-heart';
                    this.innerHTML = '<i class="fas fa-heart"></i> Liked';
                    // Here you can add code to save like to database
                } else {
                    icon.className = 'far fa-heart';
                    this.innerHTML = '<i class="far fa-heart"></i> Like';
                }
            });

            // Share functionality
            shareBtn.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: currentStory ? currentStory.title : 'ViralXHub Story',
                        text: currentStory ? currentStory.summary : 'Read this amazing story on ViralXHub',
                        url: window.location.href,
                    })
                    .catch(error => console.log('Error sharing:', error));
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(window.location.href)
                        .then(() => alert('Link copied to clipboard!'))
                        .catch(err => console.error('Could not copy text: ', err));
                }
            });

            // Open story page function (for related stories)
            window.openStoryPage = function(storyId) {
                window.location.href = `story-details.html?id=${storyId}`;
            };

            // Initialize the page
            currentStoryId = getStoryIdFromURL();
            if (currentStoryId) {
                loadStory(currentStoryId);
            } else {
                showError('No story ID provided in the URL.');
            }
        });

        // Helper function for date formatting
        function formatDate(dateString) {
            try {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString('en-US', options);
            } catch (error) {
                return 'Unknown date';
            }
        }

        // Helper function for HTML sanitization
        function sanitizeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
    </script>
</body>
</html>